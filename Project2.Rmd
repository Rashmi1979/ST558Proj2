---
title: "Project2"
author: "Rashmi Kadam, Dionte Watie"
date: "7/6/2021"
output:
  pdf_document:
    toc: true
  github_document:
    toc: true
  params: 
    day: day
    weekday: weekday
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_chunk$set(fig.path=paste0(day, "_files/figure-gfm/"))

```


# Introduction

For this study we will be aiming to predict the number of bike users. The bike users have been split into two groups that will be the target variables (response), casual bikers that rent bikes casually and registered bikers that rent bikes regularly. The predictor variables that will be in question are:

* weekday (day of the week)
* season
* yr (year)
* holiday (whether it is a holiday or not)
* weathersit (weather: rainy, snowy, clear, cloudy)
* mnth
* atemp 
* windspeed


The response and predictor variables will be used in various Multiple Linear Regression Models, Logistics Models, and Tree fits. The models will then be tested against the testing data set and the results will determine which model would be best to use for prediction.


```{r}
library(tidyverse)
library(corrplot)
library(ggplot2)
library(ggpubr)
library(caret)
library(randomForest)
```



```{r}
set.seed(1)

# read Bike data
bikeData <- read_csv("day.csv")

# filtering weekday data
bikeDataWD <- bikeData %>% filter(weekday == 1)

```
```{r}

Correlation <- cor(select(bikeDataWD, casual, registered, cnt,holiday, mnth, season,  weathersit ,yr, temp, atemp, hum, windspeed))

corrplot(Correlation)

```

```{r}
#Running the model

bikeDataM <- bikeDataWD %>% select (season, holiday, mnth, weathersit, atemp, windspeed, casual, registered, cnt, yr)

#
bikeDataM$mnth <- as.factor(bikeDataM$mnth)

bikeDataM$season <- factor(bikeDataM$season,
                          levels = c("1", "2","3","4") , 
                          labels = c("Spring","Summer","Fall","Winter"))

bikeDataM$holiday <- factor(bikeDataM$holiday, 
                           levels = c("0", "1") , 
                           labels = c("Working Day","Holiday"))


bikeDataM$weathersit <- factor(bikeDataM$weathersit,
                          levels = c("1", "2","3","4") , 
                          labels = c("Good:Clear/Sunny","Moderate:Cloudy/Mist","Bad: Rain/Snow/Fog",
                                     "Worse: Heavy Rain/Snow/Fog"))

bikeDataM$yr <- factor(bikeDataM$yr,
                      levels = c("0", "1") , 
                      labels = c("2011","2012"))

```

```{r}

train <- sample(1:nrow(bikeDataM), size = nrow(bikeDataM)*0.7)
test <- dplyr::setdiff(1:nrow(bikeDataM), train)
bikeDataTrain <- bikeDataM[train, ]
bikeDataTest <- bikeDataM[test, ]


summary(bikeDataTrain)

```
 
```{r}
#Rashmi- side by side bar plots for year, month and count
  
Year <- bikeDataTrain$yr

ggplot(bikeDataTrain, aes(fill=Year, y=cnt, x=mnth)) + 
    geom_bar(position="dodge", stat="identity") + xlab("Months") + ylab('Total Users')

```


```{r}
#Rashmi-boxplot of season versus count

ggplot(bikeDataTrain, aes(x = season,y=cnt)) +
  geom_boxplot(fill="steelblue") +ylab('Total Users')


```


```{r}
#Rashmi-- scatter plots for casual and registered versus actual temperature

mintemp <- -16
maxtemp <- 50

bikeDataTrain$atemp = bikeDataTrain$atemp * (maxtemp - mintemp) + mintemp
bikeDataTrain$atemp

  cTemp <- ggplot(bikeDataTrain,aes(x=atemp, y=casual)) + geom_point() + geom_smooth() + ylim(0, 7000) 
  rTemp <- ggplot(bikeDataTrain, aes(x=atemp, y=registered)) + geom_point() + geom_smooth() + ylim(0, 7000) 
  
  ggarrange(cTemp, rTemp, labels = c("Casual Users", "Registered Users"), ncol = 2, nrow = 1)



```


```{r}
#Summary Statistics
statsCasual <- bikeDataTrain %>% group_by(mnth) %>% summarise(avg = mean(casual), med = median(casual), var = var(casual), stDev = sd(casual))
statsCasual

statsRegistered <- bikeDataTrain %>% group_by(mnth) %>% summarise(avg = mean(registered), med = median(registered), var = var(registered), stDev = sd(registered))
statsRegistered

statsCnt <- bikeDataTrain %>% group_by(season) %>% summarise(avg = mean(cnt), med = median(cnt), var = var(cnt), stDev = sd(cnt))
statsCnt
```


```{r}
tapply(bikeDataTrain$casual, INDEX = bikeDataTrain$weathersit, FUN = function(x){x -mean(x)/sd(x)})
```



```{r}
# summary statistics by Rashmi
#min max stdev and mean of feeling temperature by season
statsAtemp <- bikeDataTrain %>%
  group_by(season) %>%
  summarise(
    atemp.min = min(atemp),
    atemp.max = max(atemp),
    atemp.med = median(atemp),
    atemp.stdev = sd(atemp),
    atemp.mean = mean(atemp))
statsAtemp

#min max stdev and mean of total bike users per year
statsYear<- bikeDataTrain %>%
  group_by(yr) %>%
  summarise(
    cnt.min = min(cnt),
    cnt.max = max(cnt),
    cnt.med = median(cnt),
    cnt.stdev = sd(cnt),
    cnt.mean = mean(cnt)) 
statsYear

#min max stdev and mean of total bike users per holiday
statsHoliday<- bikeDataTrain %>%
  group_by(holiday) %>%
  summarise(
    cnt.min = min(cnt),
    cnt.max = max(cnt),
    cnt.med = median(cnt),
    cnt.stdev = sd(cnt),
    cnt.mean = mean(cnt)) 
statsHoliday

#contingency table 



```

Fitting models

```{r warning=FALSE}
#Fitting multiple regression models

bikeDataTrainF <- bikeDataTrain %>% select(cnt,season,weathersit,atemp,yr)
bikeDataTestF <- bikeDataTest %>% select(cnt,season,weathersit,atemp,yr)

lmRM<-lm(cnt~.,data=bikeDataTrainF)
summary(lmRM)

lmFit <- train(cnt ~ ., data = bikeDataTrainF , 
         method = "lm", 
         preProcess = c("center", "scale"),
         trControl = trainControl(method = "cv", number = 10))

predlm <- predict(lmFit, newdata = dplyr::select(bikeDataTestF,-cnt))

postResample(predlm, bikeDataTestF$cnt)

```

Fitting Random forest model

```{r}

set.seed(1)


rfFit <- train(cnt ~ ., 
               method = "rf",
               trControl = trainControl(method = "repeatedcv",
                                        repeats = 3,
                                        number = 10),
               tuneGrid = data.frame(mtry = 1:9),
               data = bikeDataTrainF)
rfFit

rfPred <- predict(rfFit,  newdata = dplyr::select(bikeDataTestF,-cnt))
postResample(rfPred, bikeDataTestF$cnt)


```
